<!-- <!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Gestion des achats</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  <h1>Ajouter un achat</h1>

  <form id="purchaseForm">
    <label for="supplier">Fournisseur :</label>
    <select id="supplier" name="supplier">
      {% for supplier in suppliers %}
        <option value="{{ supplier.id }}">{{ supplier.name }}</option>
      {% endfor %}
    </select><br>

    <label for="drug">Médicament :</label>
    <select id="drug" name="drug">
      {% for drug in drugs %}
        <option value="{{ drug.id }}">{{ drug.name }}</option>
      {% endfor %}
    </select><br>

    <label for="quantity">Quantité :</label>
    <input type="number" id="quantity" name="quantity" min="1" required><br>

    <label for="unit_price">Prix unitaire :</label>
    <input type="number" id="unit_price" name="unit_price" step="0.01" min="0" required><br>

    <label for="total_cost">Coût total :</label>
    <input type="number" id="total_cost" name="total_cost" step="0.01" min="0"><br>

    <label for="purchase_date">Date d'achat :</label>
    <input type="datetime-local" id="purchase_date" name="purchase_date"><br>

    <label for="commentaire">Commentaire :</label><br>
    <textarea id="commentaire" name="commentaire"></textarea><br>

    <button type="submit">Ajouter</button>
  </form>

  <div id="message"></div>

  <script>
    document.getElementById('purchaseForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const formData = new FormData(this);
      const payload = {
        supplier: parseInt(formData.get('supplier')),
        drug: parseInt(formData.get('drug')),
        quantity: parseInt(formData.get('quantity')),
        unit_price: parseFloat(formData.get('unit_price')),
        total_cost: formData.get('total_cost') ? parseFloat(formData.get('total_cost')) : null,
        purchase_date: formData.get('purchase_date') ? new Date(formData.get('purchase_date')).toISOString() : null,
        commentaire: formData.get('commentaire')
      };

      try {
        const response = await axios.post('/purchases/add', payload);
        document.getElementById('message').innerText = response.data.message;
        this.reset();
      } catch (error) {
        if(error.response && error.response.data.errors){
          const errors = error.response.data.errors;
          document.getElementById('message').innerText = 'Erreurs: ' + JSON.stringify(errors);
        } else {
          document.getElementById('message').innerText = 'Erreur serveur';
        }
      }
    });
  </script>
</body>
</html> -->
