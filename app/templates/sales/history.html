{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <h2>Détails de la vente #{{ sale.id }}</h2>

  <p>
    <strong>Date :</strong> {{ sale.date.strftime('%d/%m/%Y %H:%M') }}<br>
    <strong>Vendu par :</strong> {{ sale.user.username }}<br>
  </p>

  <h4 class="mt-4">Produits vendus</h4>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Médicament</th>
        <th>Quantité</th>
        <th>Prix unitaire</th>
        <th>Coût total</th>
      </tr>
    </thead>
    <tbody>
      {% set ns = namespace(grand_total=0) %}
      {% for item in sale.items %}
        {% set total = item.quantity * item.unit_price %}
        {% set ns.grand_total = ns.grand_total + total %}
        <tr>
          <td>{{ item.drug.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ '%.2f'|format(item.unit_price) }} HTG</td>
          <td>{{ '%.2f'|format(total) }} HTG</td>
        </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th colspan="3" class="text-end">Total général</th>
        <th>{{ '%.2f'|format(ns.grand_total) }} HTG</th>
      </tr>
    </tfoot>
  </table>

  <a href="{{ url_for('sale.list_sales') }}" class="btn btn-secondary mt-3">← Retour à la liste des ventes</a>
  <a href="{{ url_for('sale.sale_receipt', sale_id=sale.id) }}" class="btn btn-primary mt-3" target="_blank"> Réimprimer </a>
</div>
{% endblock %}
