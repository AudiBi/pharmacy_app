{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>Détails de l'achat #{{ purchase.id }}</h2>

  <p>
    <strong>Date :</strong> {{ purchase.purchase_date.strftime('%d/%m/%Y') }}<br>
    <strong>Fournisseur :</strong> {{ purchase.supplier.name }}<br>
    {% if purchase.commentaire %}
      <strong>Commentaire :</strong> {{ purchase.commentaire }}<br>
    {% endif %}
  </p>

  <h4 class="mt-4">Produits achetés</h4>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Médicament</th>
        <th>Quantité</th>
        <th>Prix unitaire</th>
        <th>Coût total</th>
      </tr>
    </thead>
    <tbody>
      {% set ns = namespace(grand_total=0) %}
      {% for item in purchase.items %}
        {% set total = item.total_price %}
        {% set ns.grand_total = ns.grand_total + total %}
        <tr>
          <td>{{ item.drug.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ '%.2f'|format(item.unit_price) }} HTG</td>
          <td>{{ '%.2f'|format(total) }} HTG</td>
        </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th colspan="3" class="text-end">Total général</th>
        <th>{{ '%.2f'|format(ns.grand_total) }} HTG</th>
      </tr>
    </tfoot>
  </table>

  <a href="{{ url_for('purchase.list_purchases') }}" class="btn btn-secondary mt-3">← Retour à la liste</a>
</div>
{% endblock %}
