{% extends 'base.html' %}
{% block content %}
<h2>Tableau de bord (Admin)</h2>
<a href="{{ url_for('history.charts') }}" class="btn btn-outline-info mt-2">üìä Statistiques graphiques</a>
<div class="row my-4">
    <div class="col-md-4">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h5>M√©dicaments</h5>
                <p class="display-6">{{ total_drugs }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-secondary text-white">
            <div class="card-body">
                <h5>Fournisseurs</h5>
                <p class="display-6">{{ total_suppliers }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h5>Ventes</h5>
                <p class="display-6">{{ total_sales }}</p>
            </div>
        </div>
    </div>
</div>

<h3>Visualisation des alertes</h3>
<canvas id="alertChart" width="400" height="150"></canvas>

<script id="alert-data" type="application/json">
  {
    "expired_count": {{ expired_count or 0 }},
    "low_stock_count": {{ low_stock_count or 0 }},
    "soon_expired_count": {{ soon_expired_count or 0 }}
  }
</script>

<script>
  const alertData = JSON.parse(document.getElementById('alert-data').textContent);

  const ctx = document.getElementById('alertChart').getContext('2d');
  const alertChart = new Chart(ctx, {
      type: 'bar',
      data: {
          labels: ['P√©rim√©s', 'Stock faible', 'Bient√¥t p√©rim√©s'],
          datasets: [{
              label: 'Nombre de m√©dicaments',
              data: [alertData.expired_count, alertData.low_stock_count, alertData.soon_expired_count],
              backgroundColor: ['#dc3545', '#ffc107', '#17a2b8']
          }]
      },
      options: {
          responsive: true,
          scales: {
              y: {
                  beginAtZero: true,
                  stepSize: 1
              }
          }
      }
  });
</script>

{% endblock %}
