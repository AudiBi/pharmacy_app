{% extends 'base.html' %}

{% block title %}Cat√©gories de M√©dicaments{% endblock %}

{% block content %}
<div class="container mt-5">

  <h2 class="mb-4 text-success fw-bold">üìÇ Cat√©gories de m√©dicaments</h2>

  <!-- Bouton d'ajout -->
  <a href="{{ url_for('category.add_category') }}" class="btn btn-success mb-4">
    <i class="bi bi-plus-circle me-1"></i> Ajouter une cat√©gorie
  </a>

  <!-- Formulaire de recherche -->
  <form method="get" class="mb-4">
    <div class="input-group">
      <input type="text" name="search" class="form-control" placeholder="üîç Rechercher une cat√©gorie..." value="{{ search_query }}">
      <button class="btn btn-outline-primary" type="submit">
        Rechercher
      </button>
    </div>
  </form>

  {% if categories %}
    <div class="table-responsive shadow-sm rounded">
      <table class="table table-striped table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th style="width: 80px;">ID</th>
            <th>Nom</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for category in categories %}
          <tr>
            <td>{{ category.id }}</td>
            <td>{{ category.name }}</td>
            <td class="text-center">
              <a href="{{ url_for('category.edit_category', category_id=category.id) }}" class="btn btn-sm btn-warning" title="Modifier">
                <i class="bi bi-pencil-square"></i>
              </a>
              <!-- Supprimer avec modal -->
              <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ category.id }}" title="Supprimer">
                <i class="bi bi-trash"></i>
              </button>

              <!-- Modal de suppression -->
              <div class="modal fade" id="deleteModal{{ category.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ category.id }}" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <form method="POST" action="{{ url_for('category.delete_category', category_id=category.id) }}">
                      {{ delete_form_category.csrf_token }}
                      <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel{{ category.id }}">Confirmation</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                      </div>
                      <div class="modal-body">
                        √ätes-vous s√ªr de vouloir supprimer la cat√©gorie <strong>{{ category.name }}</strong> ?
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Non</button>
                        <button type="submit" class="btn btn-danger">Oui</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <nav aria-label="Pagination" class="mt-4">
      <ul class="pagination justify-content-center">
        {% if pagination.has_prev %}
          <li class="page-item">
            <a class="page-link" href="?page={{ pagination.prev_num }}&search={{ search_query }}">‚Üê Pr√©c√©dent</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">‚Üê Pr√©c√©dent</span></li>
        {% endif %}

        <li class="page-item disabled">
          <span class="page-link">Page {{ pagination.page }} / {{ pagination.pages }}</span>
        </li>

        {% if pagination.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ pagination.next_num }}&search={{ search_query }}">Suivant ‚Üí</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Suivant ‚Üí</span></li>
        {% endif %}
      </ul>
    </nav>
  {% else %}
    <div class="alert alert-info">Aucune cat√©gorie enregistr√©e pour le moment.</div>
  {% endif %}
</div>
{% endblock %}
