{% extends 'base.html' %}

{% block title %}Historique - {{ drug.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>üìä Historique du m√©dicament : <strong>{{ drug.name }}</strong></h2>
  <p><strong>Unit√© :</strong> {{ drug.unit }} | <strong>Stock actuel :</strong> {{ drug.current_stock() }} | <strong>Date d'expiration :</strong> {{ drug.expiration_date.strftime('%d/%m/%Y') }}</p>

  <hr>

  <h4>üõí Achats</h4>
  {% if purchases %}
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Date</th>
          <th>Fournisseur</th>
          <th>Quantit√©</th>
          <th>Prix unitaire</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for item in purchases %}
        <tr>
          <td>{{ item.purchase.purchase_date.strftime('%d/%m/%Y') }}</td>
          <td>{{ item.purchase.supplier.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ "%.2f"|format(item.unit_price) }}</td>
          <td>{{ "%.2f"|format(item.total_price) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Aucun achat enregistr√©.</p>
  {% endif %}

  <h4 class="mt-4">üí∞ Ventes</h4>
  {% if sales %}
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Date</th>
          <th>Quantit√©</th>
          <th>Vendu par</th>
        </tr>
      </thead>
      <tbody>
        {% for sale in sales %}
        <tr>
          <td>{{ sale.date.strftime('%d/%m/%Y %H:%M') }}</td>
          <td>{{ sale.quantity }}</td>
          <td>{{ sale.user.username }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Aucune vente enregistr√©e.</p>
  {% endif %}

  <h4 class="mt-4">‚ùå Pertes</h4>
  {% if losses %}
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Date</th>
          <th>Quantit√©</th>
          <th>Raison</th>
          <th>Commentaire</th>
        </tr>
      </thead>
      <tbody>
        {% for loss in losses %}
        <tr>
          <td>{{ loss.date.strftime('%d/%m/%Y %H:%M') }}</td>
          <td>{{ loss.quantity }}</td>
          <td>{{ loss.reason }}</td>
          <td>{{ loss.comment or "‚Äî" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Aucune perte enregistr√©e.</p>
  {% endif %}

  <a href="{{ url_for('drug.list_drugs') }}" class="btn btn-secondary mt-3">‚¨Ö Retour √† la liste</a>
</div>
{% endblock %}
